\documentclass[runningheads, orivec]{llncs}
%
%
\usepackage{geometry}
\geometry{
  a4paper,         % or letterpaper
  textwidth=14cm,  % llncs has 12.2cm
  textheight=22cm, % llncs has 19.3cm
  heightrounded,   % integer number of lines
  hratio=1:1,      % horizontally centered
  vratio=2:3,      % not vertically centered
}
\usepackage[T1]{fontenc}
% T1 fonts will be used to generate the final print and online PDFs,
% so please use T1 fonts in your manuscript whenever possible.
% Other font encondings may result in incorrect characters.
%
\usepackage{graphicx}
% Used for displaying a sample figure. If possible, figure files should
% be included in EPS format.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%% MY PACKAGES %%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{xspace}
\usepackage{subcaption}
%\usepackage[gray]{xcolor}
\usepackage{xcolor}
\usepackage{tikz}
\usetikzlibrary{calc, arrows.meta, math, positioning, decorations.pathreplacing, patterns, shapes}
\usepackage[colorlinks=true, linkcolor=blue, urlcolor=blue, citecolor = blue]{hyperref}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{semantic}
\usepackage{mathtools}
\usepackage{todonotes}
\usepackage[acronym]{glossaries}
\usepackage{bbding}
\usepackage{orcidlink}
\usepackage[capitalize]{cleveref}
\usepackage{xpatch}
\usepackage{eulervm}

\usepackage{pgfplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat=1.16}
\usepgfplotslibrary{groupplots}

\definecolor{codebg}{HTML}{eeeeee}
\usepackage{minted}
\setminted{fontsize=\footnotesize, bgcolor=codebg}
\usemintedstyle{tango}

\usepackage{newunicodechar}
\newunicodechar{Π}{\ensuremath{\Pi}}
\newunicodechar{Φ}{\ensuremath{\Phi}}
\newunicodechar{∗}{\ensuremath{\ast}}
\newunicodechar{⌜}{\ensuremath{\ulcorner}}
\newunicodechar{⌝}{\ensuremath{\urcorner}}
\newunicodechar{∃}{\ensuremath{\boldsymbol\exists}}
\newunicodechar{κ}{\ensuremath{\kappa}}
\newunicodechar{σ}{\ensuremath{\sigma}}
\newunicodechar{↪}{\ensuremath{\hookrightarrow}}
\newunicodechar{≡}{\ensuremath{\equiv}}
\newunicodechar{□}{\ensuremath{\square}}


% If you use the hyperref package, please uncomment the following two lines
% to display URLs in blue roman font according to Springer's eBook style:
\usepackage{color}
\renewcommand\UrlFont{\color{blue}\rmfamily}
\urlstyle{rm}

\glsdisablehyper
\newacronym{cfg}{CFG}{context-free grammar}

\begin{document}

\title{Modular I/O Reasoning in DimSum}
%
%\titlerunning{Abbreviated paper title}
% If the paper title is too long for the running head, you can set
% an abbreviated paper title here
%
\author{Alexander Loitzl\Envelope\orcidlink{0009-0002-7417-2537}}%
\authorrunning{A. Loitzl}
% First names are abbreviated in the running head.
% If there are more than two authors, 'et al.' is used.
%

\institute{Institute of Science and Technology Austria, Klosterneuburg, Austria\\
\email{alexander.loitzl@ista.ac.at}}
%
\maketitle              % typeset the header of the contribution
%
%
% Abstract: an introduction conveying the general scientific background, research methodology and overall investigation status of the overarching scientific question in the pertinent scientific field

\begin{abstract}
  Hoare logic provides a framework for modularly reasoning about program behavior and in the more powerful setting of separation logic can be used to verify various low-level aspects of interest like memory-safety and exclude data-races. On the other hand, reasoning about the input/output behavior of a program has not been studied much.
  This is the main motivation for ongoing work built on top of DimSum enabling modular proofs.
  We report on the rotation project which aim was to first gain some insights into DimSum and the tools used in it's proofs and then to turn to experimenting with I/O reasoning.
  We added some new lemmas and gained valuable insights into the fixing of the environment for each module.
\end{abstract}

\section{Background}
Below, we briefly present relevant aspects of DimSum\cite{dimsum} and the initial motivation for the project.
\subsection{Modular I/O Reasoning}

In \cite{io1,io2},  a modular approach based on separation logic for capturing the interactive (I/O) behavior programs is proposed. We build on their approach, but use more general abstract nested hoare triples rather than their approach based on Petri Nets. The arbitrary nesting of triples allows us to write specifications in which we capture the execution order of functions and allows us to refer to previous output values rather than introducing existential quantifiers.

Below we give a spec for a simple echo function with a nested specification. Note that the binder for the postcondition is a parameter of the specification. In particular, the specification can be read as, \textit{If we call echo with no arguments, then call getc with no arguments, then call putc with the output of getc, echo returns 0}.
\begin{align*}
  \texttt{echo}\Biggl\{&\lambda \text{ es POST}{}_e\text{, ⌜es = [ ]⌝}\ \ast\\
  &\ \ \texttt{getc}\biggl\{\lambda \text{ es POST}{}_1\text{, ⌜es = [ ]⌝}\ \ast\ \text{POST}_1\ \Bigl(\lambda \text{ v, }\\
  &\quad\ \ \texttt{putc}\bigl\{\lambda \text{ es POST}_2 \text{, ⌜es = v⌝}\ \ast\ \text{POST}_2 \bigl(\lambda \text{\_, POST}_e\ (\lambda \text{v, ⌜v = 0⌝})\bigr)\bigr\}\Bigr)\biggr\}\Biggr\}
\end{align*}



\subsection{DimSum}
DimSum is a framework for multi-language reasoning realized in the Rocq theorem prover. Program semantics are defined as LTS (modules) which, like in process algebra, interact by synchronizing on events. DimSum allows for interaction between arbitrary modules, as long as they agree on the used events. In particular, this can allow interaction of modules from different languages or specifications. This is achieved by special modules which translate events between two languages. Similarly, two modules can be linked by wrapping them in a special module which captures the outgoing events and potentially synchronizing with a linked module.

The recently added suppport for Hoare-style reasoning is othogonal to the previous focus of DimSum. Rather than ensuring smooth interaction of modules, we are focusing on the module-local reasoning by abstracting the environment and viewing it abstractly as a postcondition $\Pi$. The Hoare-triples are then parameterized by such a post-condition and the notion of a \texttt{switch} is introduced to impose pre- and post-conditions on the environment. Intuitively, a switch captures a change from module local reasoning to the environment. We will see some examples later.

\section{Rotation Project}

The main objective of the rotation (as stated in the pre-rotation protocol) was to get familiar with DimSum and the tools used in its design. Mainly the SSreflect tactic language and Separation logic and the Iris Proof Mode. The means to achieve this goal was through a succession of various small verification tasks, first in the original proof style and later with the newly, partially developped modular hoare reasoning style.

The small examples served as stepping stones to get a more fundamental understanding of the framework and included simple functions and specifications.

\subsection{Main Challenge}

The main challenge chrystalized rather quickly and is the correctness proof of the following program in DimSum's Rec Language.

The main problem worked on during the rotation was the proof for the following program. The module on the left, is the linked module of the echo program with a getc spec.
The programm captures the main challenges of the project well, since through the recursion, one can not use any shortcuts. All components must be used in such a way that the ownership of resources has not changed.

\begin{figure}[h]
  \centering
  \hspace{.3em}
  \begin{subfigure}[b]{0.21\textwidth}
    \centering
    \begin{minipage}{\textwidth}
      \centering
      \inputminted[bgcolor=codebg]{c} {echo.rec}
    \end{minipage}
  \end{subfigure}
  %% \hspace{3em}
  \hfill
  \begin{subfigure}[b]{0.35\textwidth}
    \centering
    \begin{minipage}{\textwidth}
      \centering
      \inputminted[bgcolor=codebg]{coq} {getc.spec}
    \end{minipage}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.4\textwidth}
    \centering
    \begin{minipage}{\textwidth}
      \centering
      \inputminted[bgcolor=codebg]{coq} {echo_getc.spec}
    \end{minipage}
  \end{subfigure}

  \caption{code of CompCert (left) and (right)}
  %\label{fig:design:example3}
\end{figure}


\subsection{Switching Notation}
% TODO: parts of this should probably
One other interesting aspect of the rotation is how to communicate the intuition correctly. The main focus of DimSum, being a framework for multi-language reasoning, was modeling the interaction of different components and giving good stuff for that.
The outcome of the ongoing discussions is a notation proposed by Michael Sammler, which was so far only used in order present the final results to the group, but has not been tested within the Rocq theorem prover.

\begin{figure}[h]
  \centering
  \hspace{.3em}
  \begin{subfigure}[b]{0.48\textwidth}
    \centering
    \begin{minipage}{\textwidth}
      \centering
      \inputminted[bgcolor=codebg]{coq} {getc_prepost_short.v}
    \end{minipage}
  \end{subfigure}
  %% \hspace{3em}
  \hfill
  \begin{subfigure}[b]{0.42\textwidth}
    \centering
    \begin{minipage}{\textwidth}
      \centering
      \inputminted[bgcolor=codebg]{coq} {echo_prepost.v}
    \end{minipage}
  \end{subfigure}
  \begin{subfigure}[b]{0.75\textwidth}
    \centering
    \begin{minipage}{\textwidth}
      \centering
      \inputminted[bgcolor=codebg]{coq} {sim_getc.v}
    \end{minipage}
  \end{subfigure}
  %
  \caption{code of CompCert (left) and (right)}
  %\label{fig:design:example3}
\end{figure}



\section{Discussion}

Below we discuss the outcome and future directions. We also talk about challenges since it is closely related to future work. The tool should be usuable and one of the goal is to find the right level to talk about.

\subsection{Outcome}

A simple lemma which allows straight forward reasoning about the \textcolor{red}{compound} operation `TCallRet'.
We have sucessfully used in in multiple proofs with a straightforward corollary of TWaitingRaw

Fix $\Pi$ upfront, and additional definitions and lemmas about the linking module were added.

\subsection{Challenges \& Future Work}

A top down approach was chosen...
It is hard to do say what is the correct way to do it. It could have been nice to develop an intuition for switches this way, but didn't happen.

How to communicate...

Multilanguage...

\bibliographystyle{splncs04.bst}
\bibliography{references}

\end{document}
