\PassOptionsToPackage{table}{xcolor}
\documentclass[usenames,dvipsnames, table]{beamer}
\usepackage{verbatim}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{./theme/beamerthemepresentation}
\addtobeamertemplate{footnote}{}{\vspace{2ex}}
\usepackage{amsmath}
\usepackage{stmaryrd}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{mathtools}
\usepackage{tikz}
\usepackage{mathptmx}
\usepackage{changepage}
\usepackage{listings}
\usepackage{textcomp}
\usepackage{subcaption}
\usepackage{semantic}
\usepackage{marvosym}
\usepackage{bm}
\usepackage[T1]{fontenc}
\usepackage{eulervm}
%% \usepackage{DejaVuSansMono}

\usetikzlibrary{calc, arrows.meta, intersections, patterns, positioning, shapes.misc, fadings, through,decorations.pathreplacing, math}
\usetikzlibrary{arrows,automata,positioning, calc, arrows.meta, chains, decorations.pathreplacing, shapes.geometric, shapes.arrows, shadows.blur}
%%% Bibliography
\usepackage[style=authoryear,backend=biber, style=alphabetic]{biblatex}
\addbibresource{references.bib}

\DeclarePairedDelimiter\Brackets{\lBrack}{\rBrack}

\mode<presentation> { \setbeamercovered{transparent} }
\setbeamertemplate{navigation symbols}{}
\def\beamerorig@set@color{%
  \pdfliteral{\current@color}%
  \aftergroup\reset@color
}
\def\beamerorig@reset@color{\pdfliteral{\current@color}}
\newcounter{bibitmctr}
\newcommand{\brf}{%
  \stepcounter{bibitmctr}%
  \ifnum\value{bibitmctr}=5%
    \setcounter{bibitmctr}{0}
    \framebreak
  \fi
}

\usepackage{minted}
\usepackage{newunicodechar}
\newunicodechar{Π}{\ensuremath{\Pi}}
\newunicodechar{Φ}{\ensuremath{\Phi}}
\newunicodechar{∗}{\ensuremath{\ast}}
\newunicodechar{⌜}{\ensuremath{\ulcorner}}
\newunicodechar{⌝}{\ensuremath{\urcorner}}
\newunicodechar{∃}{\ensuremath{\boldsymbol\exists}}
\newunicodechar{κ}{\ensuremath{\kappa}}
\newunicodechar{σ}{\ensuremath{\sigma}}
\newunicodechar{↪}{\ensuremath{\hookrightarrow}}
\newunicodechar{≡}{\ensuremath{\equiv}}
\newunicodechar{□}{\ensuremath{\square}}
\usepackage{xspace}
\usepackage{ragged2e}
\usepackage{pgfplots}
\usepackage{soul}
\usepackage{pgfplotstable}
\pgfplotsset{compat=1.16}
\usepgfplotslibrary{groupplots}
\usepackage{booktabs}
\usepackage{array}
\usepackage{xpatch}
\usepackage[nott]{inconsolata}
%\usepackage{beramono}
%\usepackage[scaled=0.8]{FiraMono}

%%% Some useful commands
% pdf-friendly newline in links
\newcommand{\pdfnewline}{\texorpdfstring{\newline}{ }}
% Fill the vertical space in a slide (to put text at the bottom)
\newcommand{\framefill}{\vskip0pt plus 1filll}

\renewcommand*{\bibfont}{\scriptsize}

\newenvironment<>{varblock}[2][\textwidth]{%
  \setlength{\textwidth}{#1}
  \begin{actionenv}#3%
    \def\insertblocktitle{#2}%
    \par%
    \usebeamertemplate{block begin}}
  {\par%
    \usebeamertemplate{block end}%
  \end{actionenv}}

\TPGrid[0mm,0mm]{20}{20}
\definecolor{codebg}{HTML}{eeeeee}
\definecolor{codegreen}{HTML}{73d216}
\setminted{fontsize=\small, escapeinside=!!, bgcolor=codebg}
\usemintedstyle{tango}

\makeatletter
\AtBeginEnvironment{minted}{\dontdofcolorbox}
\def\dontdofcolorbox{\renewcommand\fcolorbox[4][]{##4}}
\xpatchcmd{\inputminted}{\minted@fvset}{\minted@fvset\dontdofcolorbox}{}{}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}

\title[Modular I/O Reasoning in DimSum]{Modular I/O Reasoning in DimSum}
\date[March 2025]{March, 2025}
\author[]{
  {\large Alex Loitzl${}^{1}$}
  \pdfnewline
  \pdfnewline
  \pdfnewline
  \pdfnewline
  \pdfnewline
  \pdfnewline
  \pdfnewline
  {\small ${}^{1}$Institute of Science and Technology Austria (ISTA)}
	%180.773 Seminar for Master Students in L\&C
}

\begin{document}
\addtocounter{framenumber}{0}

\begin{frame}
\titlepage
\end{frame}
% Title Slide
% Basic CompCert slide
% Example
% Challgenges
% Register Files
% Design slide
% Tables/Evaluation
% List of contributions

\section{Background}

\begin{frame}{Modular I/O Reasoning}

\begin{textblock}{5.5}[0,0](1.5,3)
      \inputminted[bgcolor=codebg, fontsize=\small]{c} {code/echo.rec}
\end{textblock}


\only<1>{
\begin{textblock}{20}[0,0](0,10)
  \centering
  \{...\} \texttt{echo} \{...\}
\end{textblock}}

\only<2>{
\begin{textblock}{20}[0,0](0,10)
  \centering
  \{$\lambda$ es, ⌜es = [ ]⌝\} \texttt{echo} \{$\lambda$ v, ⌜v = 0⌝\}
\end{textblock}}

\only<3>{
\begin{textblock}{20}[0,0](0,10)
  \centering
  {\LARGE\{}$\lambda$ es, ⌜es = [ ]⌝ $\ast$ {\large\{}$\lambda$ es, ⌜es = [ ]⌝{\large\}}\texttt{getc}{\large\{}$\lambda$ v, \{$\lambda$ es, ⌜es = v⌝\}\texttt{putc}\{\_\} {\large\}}{\LARGE\}}\\
    \texttt{echo}\\
  {\LARGE\{}$\lambda$ v, ⌜v = 0⌝{\LARGE\}}
\end{textblock}}

\only<5->{
\begin{textblock}{20}[0,0](0,8)
  \centering
  \{$\lambda$ es, ⌜es = [ ]⌝ $\ast$ $\boldsymbol{\exists}$ v, P v\}
    \texttt{getc}
  \{$\lambda$ ret, ⌜ret = v⌝ $\ast$ P (v + 1)\}
\end{textblock}}

\only<5>{
\begin{textblock}{20}[0,0](0,10)
  \centering
  \{$\lambda$ es, $\boldsymbol{\exists}$ v, ⌜es = v⌝ $\ast$ P (v + 1)\}
    \texttt{putc}
  \{$\lambda$ ret, P (v + 1)\}
\end{textblock}}

\only<4->{
\begin{textblock}{20}[0,0](0,12)
  \centering
  \{$\lambda$ es, ⌜es = [ ]⌝ $\ast$ $\boldsymbol{\exists}$ v, P v $\ast$ (\texttt{getc\_spec} P) $\ast$ (\texttt{putc\_spec} P)\}\\
    \texttt{echo}\\
  \{$\lambda$ v, ⌜v = 0⌝\}
\end{textblock}}



\end{frame}

\begin{frame}{Multi-language Reasoning in DimSum}
\end{frame}

\begin{frame}{Proofs in DimSum}
  \begin{textblock}{20}[0.5,0.5](10,12)
    \begin{figure}
    \centering
    \input{verification.tex}
    \end{figure}
  \end{textblock}
\end{frame}

\begin{frame}{Towards Hoare-style Reasoning}
  \begin{textblock}{20}[0,0](0,2)
    \begin{figure}
    \centering
    \input{verification2.tex}
    \end{figure}
  \end{textblock}
\end{frame}

\begin{frame}{(Modular) Hoare-style Reasoning}

  \only<1-2>{
  \begin{textblock}{10.5}[0,0](.5,8)
    \begin{figure}[h]
      \centering
      \begin{minipage}{\textwidth}
        \centering
        \inputminted[bgcolor=codebg, fontsize=\scriptsize]{coq} {code/getc_prepost1.v}
      \end{minipage}
    \end{figure}
  \end{textblock}}

  \only<2->{
  \begin{textblock}{10.6}[0,0](8,4)
    \begin{figure}[h]
      \centering
      \begin{minipage}{\textwidth}
        \centering
        \inputminted[bgcolor=codebg, fontsize=\scriptsize]{coq} {code/real_getc_prepost.v}
      \end{minipage}
    \end{figure}
  \end{textblock}}

  \only<3>{
  \begin{textblock}{12}[0,0](.5,8)
    \begin{figure}[h]
      \centering
      \begin{minipage}{\textwidth}
        \centering
        \inputminted[bgcolor=codebg, fontsize=\scriptsize]{coq} {code/getc_prepost.v}
      \end{minipage}
    \end{figure}
  \end{textblock}}

  %% \begin{textblock}{8}[0,0] (11,2)
  %% \end{textblock}
\end{frame}


\begin{frame}{Example 1}

  \begin{textblock}{18}[0,0](1,4)
  \centering
  \Large$\llbracket \textcolor{red}{\text{echo}_{\text{rec}}}\bm{\oplus} \text{getc}_{\text{spec}} \rrbracket\boldsymbol{\preceq}\llbracket \text{echo}_{\text{spec}} \rrbracket$
  \end{textblock}

  %% \only<1>{
  %% \begin{textblock}{18}[0,0](1,6)
  %%   \begin{figure}[h]
  %%     \centering
  %%     \begin{minipage}{\textwidth}
  %%       \centering
  %%       \inputminted[bgcolor=codebg, fontsize=\scriptsize]{coq} {code/sim_getc_spec.v}
  %%     \end{minipage}
  %%   \end{figure}
  %% \end{textblock}}

  \begin{textblock}{18}[0,0](1,6)
    \begin{figure}[h]
      \centering
      \begin{minipage}{\textwidth}
        \centering
        \only<1>{
        \inputminted[bgcolor=codebg, fontsize=\scriptsize]{coq} {code/sim_getc_spec.v}}
        \only<2>{
        \inputminted[bgcolor=codebg, fontsize=\scriptsize, highlightlines={3-4}, highlightcolor=yellow!60]{coq} {code/sim_getc_spec.v}}
        \only<3>{
        \inputminted[bgcolor=codebg, fontsize=\scriptsize, highlightlines={5-6}, highlightcolor=yellow!60]{coq} {code/sim_getc_spec.v}}
        \only<4>{
        \inputminted[bgcolor=codebg, fontsize=\scriptsize, highlightlines={8-9}, highlightcolor=yellow!60]{coq} {code/sim_getc_spec.v}}
        \only<5>{
        \inputminted[bgcolor=codebg, fontsize=\scriptsize, highlightlines={10-11}, highlightcolor=yellow!60]{coq} {code/sim_getc_spec.v}}
      \end{minipage}
    \end{figure}
  \end{textblock}
\end{frame}


\begin{frame}{Example 2}

  \only<1>{
  \begin{textblock}{18}[0,0](1,4)
  \centering
  \Large$\llbracket \textcolor{red}{\text{echo}_{\text{rec}}}\bm{\oplus} \text{getc}_{\text{spec}} \rrbracket\boldsymbol{\preceq}\llbracket \text{echo}_{\text{spec}} \rrbracket$
  \end{textblock}}

  \only<1>{
  \begin{textblock}{18}[0,0](1,6)
    \begin{figure}[h]
      \centering
      \begin{minipage}{\textwidth}
        \centering
        \inputminted[bgcolor=codebg, fontsize=\scriptsize]{coq} {code/sim_getc.v}
      \end{minipage}
    \end{figure}
  \end{textblock}}

  \only<2>{
  \begin{textblock}{18}[0,0](1,3)
    \begin{figure}[h]
      \centering
      \begin{minipage}{\textwidth}
        \centering
        \inputminted[bgcolor=codebg, fontsize=\scriptsize]{coq} {code/sim_getc2.v}
      \end{minipage}
    \end{figure}
  \end{textblock}}
  %% \begin{textblock}{8}[0,0] (11,2)
  %% \end{textblock}
\end{frame}

\begin{frame}{Outcome \& Takeaways}
\begin{itemize}
\item Lemma for \texttt{TCallRet}
\item Keep $\Pi$s the same - new lemmas for linking
\item Balance between Abstraction and Information
\item Balance between Hacking and Thinking
\end{itemize}
\end{frame}

\end{document}
